# 国际化（i18n）规范（可选）

> 使用 react-i18next 实现多语言支持的规范

## 适用场景

如果项目需要支持多语言，使用本规范。

## 技术选型

- **i18n 库**：react-i18next
- **依赖**：i18next、react-i18next
- **格式**：JSON 文件存储语料

## 安装配置

### 安装依赖

```bash
pnpm install i18next react-i18next
```

### 目录结构

```
src/
├── locales/                    # 多语言文件目录
│   ├── zh-CN/                 # 中文简体
│   │   ├── common.json        # 通用语料
│   │   ├── pages.json         # 页面语料
│   │   ├── components.json    # 组件语料
│   │   └── messages.json      # 提示消息
│   ├── en-US/                 # 英文
│   │   ├── common.json
│   │   ├── pages.json
│   │   ├── components.json
│   │   └── messages.json
│   └── index.js               # i18n 配置入口
│
├── components/
├── pages/
└── main.jsx
```

### 基础配置

```javascript
// src/locales/index.js
import i18n from 'i18next'
import { initReactI18next } from 'react-i18next'

// 导入语料文件
import zhCN_common from './zh-CN/common.json'
import zhCN_pages from './zh-CN/pages.json'
import zhCN_components from './zh-CN/components.json'
import zhCN_messages from './zh-CN/messages.json'

import enUS_common from './en-US/common.json'
import enUS_pages from './en-US/pages.json'
import enUS_components from './en-US/components.json'
import enUS_messages from './en-US/messages.json'

// 配置资源
const resources = {
  'zh-CN': {
    common: zhCN_common,
    pages: zhCN_pages,
    components: zhCN_components,
    messages: zhCN_messages,
  },
  'en-US': {
    common: enUS_common,
    pages: enUS_pages,
    components: enUS_components,
    messages: enUS_messages,
  },
}

// 初始化 i18n
i18n
  .use(initReactI18next)
  .init({
    resources,
    lng: localStorage.getItem('language') || 'zh-CN', // 默认语言
    fallbackLng: 'zh-CN', // 回退语言
    interpolation: {
      escapeValue: false, // React 已经处理了 XSS
    },
    ns: ['common', 'pages', 'components', 'messages'], // 命名空间
    defaultNS: 'common', // 默认命名空间
  })

export default i18n
```

```jsx
// src/main.jsx
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App'
import './locales' // 导入 i18n 配置

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
)
```

## 语料文件组织

### 命名空间划分

推荐按功能模块划分命名空间：

1. **common** - 通用语料（按钮、标签、常用词）
2. **pages** - 页面特定语料
3. **components** - 组件特定语料
4. **messages** - 提示消息（成功、错误、警告）

### 语料文件示例

```json
// src/locales/zh-CN/common.json
{
  "app": {
    "title": "我的应用",
    "description": "这是一个示例应用"
  },
  "button": {
    "submit": "提交",
    "cancel": "取消",
    "confirm": "确认",
    "delete": "删除",
    "edit": "编辑",
    "save": "保存",
    "search": "搜索"
  },
  "label": {
    "name": "姓名",
    "email": "邮箱",
    "phone": "电话",
    "address": "地址",
    "status": "状态"
  },
  "status": {
    "active": "活跃",
    "inactive": "未激活",
    "pending": "待处理"
  },
  "time": {
    "today": "今天",
    "yesterday": "昨天",
    "week": "本周",
    "month": "本月"
  }
}
```

```json
// src/locales/zh-CN/pages.json
{
  "home": {
    "title": "首页",
    "welcome": "欢迎回来，{{name}}！",
    "description": "这是首页内容"
  },
  "user": {
    "title": "用户管理",
    "list": {
      "title": "用户列表",
      "empty": "暂无用户数据",
      "total": "共 {{count}} 个用户"
    },
    "detail": {
      "title": "用户详情",
      "info": "基本信息",
      "createdAt": "创建时间：{{date}}"
    },
    "form": {
      "create": "创建用户",
      "edit": "编辑用户",
      "placeholder": {
        "name": "请输入姓名",
        "email": "请输入邮箱"
      }
    }
  }
}
```

```json
// src/locales/zh-CN/components.json
{
  "userCard": {
    "viewProfile": "查看资料",
    "followers": "{{count}} 个关注者",
    "following": "关注中"
  },
  "pagination": {
    "prev": "上一页",
    "next": "下一页",
    "page": "第 {{current}} 页，共 {{total}} 页"
  },
  "header": {
    "home": "首页",
    "about": "关于",
    "contact": "联系我们",
    "login": "登录",
    "logout": "退出"
  }
}
```

```json
// src/locales/zh-CN/messages.json
{
  "success": {
    "created": "创建成功",
    "updated": "更新成功",
    "deleted": "删除成功",
    "saved": "保存成功"
  },
  "error": {
    "network": "网络错误，请稍后重试",
    "required": "{{field}} 不能为空",
    "invalid": "{{field}} 格式不正确",
    "notFound": "未找到相关数据",
    "serverError": "服务器错误",
    "unauthorized": "未授权，请先登录"
  },
  "warning": {
    "unsaved": "有未保存的更改",
    "confirmDelete": "确定要删除 {{name}} 吗？"
  },
  "info": {
    "loading": "加载中...",
    "processing": "处理中...",
    "noData": "暂无数据"
  }
}
```

### 对应的英文语料

```json
// src/locales/en-US/common.json
{
  "app": {
    "title": "My App",
    "description": "This is a sample application"
  },
  "button": {
    "submit": "Submit",
    "cancel": "Cancel",
    "confirm": "Confirm",
    "delete": "Delete",
    "edit": "Edit",
    "save": "Save",
    "search": "Search"
  },
  "label": {
    "name": "Name",
    "email": "Email",
    "phone": "Phone",
    "address": "Address",
    "status": "Status"
  },
  "status": {
    "active": "Active",
    "inactive": "Inactive",
    "pending": "Pending"
  },
  "time": {
    "today": "Today",
    "yesterday": "Yesterday",
    "week": "This Week",
    "month": "This Month"
  }
}
```

## 使用方法

### 在组件中使用

```jsx
// src/components/UserCard/index.jsx
import { useTranslation } from 'react-i18next'
import './styles.css'

function UserCard({ user }) {
  const { t } = useTranslation('components') // 指定命名空间

  return (
    <div className="user-card">
      <img src={user.avatar} alt={user.name} />
      <h3>{user.name}</h3>
      <p>{t('userCard.followers', { count: user.followers })}</p>
      <button>{t('userCard.viewProfile')}</button>
    </div>
  )
}

export default UserCard
```

### 在页面中使用

```jsx
// src/pages/UserManagement/index.jsx
import { useState, useEffect } from 'react'
import { useTranslation } from 'react-i18next'
import { userAPI } from '../../api/user'
import UserCard from '../../components/UserCard'
import './styles.css'

function UserManagement() {
  const { t } = useTranslation(['pages', 'messages']) // 使用多个命名空间
  const [users, setUsers] = useState([])
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState(null)

  useEffect(() => {
    loadUsers()
  }, [])

  const loadUsers = async () => {
    try {
      setLoading(true)
      setError(null)
      const data = await userAPI.getList()
      setUsers(data)
    } catch (err) {
      setError(t('messages:error.network'))
    } finally {
      setLoading(false)
    }
  }

  if (loading) return <div>{t('messages:info.loading')}</div>
  if (error) return <div>{error}</div>
  if (users.length === 0) return <div>{t('pages:user.list.empty')}</div>

  return (
    <div className="user-management">
      <h1>{t('pages:user.title')}</h1>
      <p>{t('pages:user.list.total', { count: users.length })}</p>
      <div className="user-list">
        {users.map(user => (
          <UserCard key={user.id} user={user} />
        ))}
      </div>
    </div>
  )
}

export default UserManagement
```

### 使用默认命名空间

```jsx
// 如果使用 common（默认命名空间），可以省略前缀
import { useTranslation } from 'react-i18next'

function MyButton() {
  const { t } = useTranslation() // 默认使用 common

  return (
    <button>{t('button.submit')}</button> // 等同于 t('common:button.submit')
  )
}
```

### 切换语言

```jsx
// src/components/LanguageSwitcher/index.jsx
import { useTranslation } from 'react-i18next'
import './styles.css'

function LanguageSwitcher() {
  const { i18n } = useTranslation()

  const changeLanguage = (lng) => {
    i18n.changeLanguage(lng)
    localStorage.setItem('language', lng) // 保存语言选择
  }

  return (
    <div className="language-switcher">
      <button
        onClick={() => changeLanguage('zh-CN')}
        className={i18n.language === 'zh-CN' ? 'active' : ''}
      >
        中文
      </button>
      <button
        onClick={() => changeLanguage('en-US')}
        className={i18n.language === 'en-US' ? 'active' : ''}
      >
        English
      </button>
    </div>
  )
}

export default LanguageSwitcher
```

## 高级用法

### 变量插值

```json
// 语料文件
{
  "welcome": "欢迎，{{name}}！",
  "itemCount": "您有 {{count}} 个项目"
}
```

```jsx
// 组件中使用
t('welcome', { name: '张三' })
// 输出：欢迎，张三！

t('itemCount', { count: 5 })
// 输出：您有 5 个项目
```

### 复数形式

```json
// 语料文件
{
  "itemCount": "您有 {{count}} 个项目",
  "itemCount_zero": "您没有项目",
  "itemCount_one": "您有 1 个项目",
  "itemCount_other": "您有 {{count}} 个项目"
}
```

```jsx
// 使用
t('itemCount', { count: 0 }) // 您没有项目
t('itemCount', { count: 1 }) // 您有 1 个项目
t('itemCount', { count: 5 }) // 您有 5 个项目
```

### 嵌套翻译

```json
{
  "user": {
    "profile": {
      "name": "姓名",
      "email": "邮箱",
      "settings": {
        "title": "设置",
        "privacy": "隐私设置"
      }
    }
  }
}
```

```jsx
t('user.profile.name') // 姓名
t('user.profile.settings.title') // 设置
```

### 数组翻译

```json
{
  "steps": [
    "第一步：填写信息",
    "第二步：确认提交",
    "第三步：完成"
  ]
}
```

```jsx
t('steps.0') // 第一步：填写信息
t('steps.1') // 第二步：确认提交
```

### 格式化日期和数字

```jsx
import { useTranslation } from 'react-i18next'

function MyComponent() {
  const { t, i18n } = useTranslation()

  // 格式化日期
  const date = new Date()
  const formattedDate = date.toLocaleDateString(i18n.language)

  // 格式化数字
  const number = 1234567.89
  const formattedNumber = number.toLocaleString(i18n.language)

  return (
    <div>
      <p>{formattedDate}</p>
      <p>{formattedNumber}</p>
    </div>
  )
}
```

## 命名规范

### 语料 Key 命名

| 类型 | 规范 | 示例 |
|------|------|------|
| 页面标题 | `<page>.title` | `user.title` |
| 按钮文本 | `button.<action>` | `button.submit` |
| 标签文本 | `label.<field>` | `label.name` |
| 提示消息 | `<type>.<action>` | `success.created` |
| 占位符 | `placeholder.<field>` | `placeholder.email` |
| 状态文本 | `status.<state>` | `status.active` |

### 命名空间命名

| 命名空间 | 用途 | 文件名 |
|---------|------|--------|
| common | 通用语料（按钮、标签） | `common.json` |
| pages | 页面特定语料 | `pages.json` |
| components | 组件特定语料 | `components.json` |
| messages | 提示消息 | `messages.json` |
| errors | 错误消息（可选） | `errors.json` |
| validation | 表单验证（可选） | `validation.json` |

### 语言代码

使用标准的语言-地区代码：

- `zh-CN` - 中文简体
- `zh-TW` - 中文繁体
- `en-US` - 英语（美国）
- `en-GB` - 英语（英国）
- `ja-JP` - 日语
- `ko-KR` - 韩语

## 最佳实践

### 1. 语料文件组织

✅ **推荐做法：**
```json
{
  "user": {
    "list": {
      "title": "用户列表",
      "empty": "暂无数据"
    },
    "detail": {
      "title": "用户详情"
    }
  }
}
```

❌ **避免做法：**
```json
{
  "userListTitle": "用户列表",
  "userListEmpty": "暂无数据",
  "userDetailTitle": "用户详情"
}
```

### 2. 变量命名

✅ **推荐使用有意义的变量名：**
```json
{
  "welcome": "欢迎，{{userName}}！",
  "orderInfo": "订单号：{{orderId}}，金额：{{amount}}"
}
```

❌ **避免使用无意义的变量名：**
```json
{
  "welcome": "欢迎，{{0}}！",
  "orderInfo": "订单号：{{a}}，金额：{{b}}"
}
```

### 3. 保持语料同步

- ✅ 所有语言的语料文件结构必须一致
- ✅ 添加新语料时，同时更新所有语言版本
- ✅ 使用相同的 key 结构

```json
// zh-CN/common.json
{
  "button": {
    "submit": "提交",
    "cancel": "取消"
  }
}

// en-US/common.json
{
  "button": {
    "submit": "Submit",
    "cancel": "Cancel"
  }
}
```

### 4. 避免在语料中使用 HTML

❌ **错误：**
```json
{
  "welcome": "<strong>欢迎</strong>回来！"
}
```

✅ **正确：**
```jsx
// 在组件中处理样式
<p>
  <strong>{t('welcome.prefix')}</strong>
  {t('welcome.suffix')}
</p>
```

### 5. 使用命名空间隔离

```jsx
// ✅ 推荐：明确指定命名空间
const { t } = useTranslation(['pages', 'messages'])
t('pages:user.title')
t('messages:success.created')

// ✅ 也可以：使用单个命名空间
const { t } = useTranslation('pages')
t('user.title')
```

### 6. 提取可复用的语料

```json
// common.json - 通用语料
{
  "action": {
    "create": "创建",
    "edit": "编辑",
    "delete": "删除"
  }
}

// pages.json - 页面特定语料复用 common
{
  "user": {
    "createUser": "创建用户",  // 可以用 t('common:action.create') + '用户'
    "editUser": "编辑用户"
  }
}
```

### 7. 默认值和回退

```jsx
// 使用默认值
t('some.missing.key', '默认文本')

// 检查翻译是否存在
i18n.exists('some.key')
```

### 8. Context 集成（可选）

如果项目使用 Context 管理全局状态，可以将 i18n 集成进去：

```jsx
// src/context/AppContext.jsx
import { createContext, useContext } from 'react'
import { useTranslation } from 'react-i18next'

const AppContext = createContext(null)

export function AppProvider({ children }) {
  const { t, i18n } = useTranslation()

  const changeLanguage = (lng) => {
    i18n.changeLanguage(lng)
    localStorage.setItem('language', lng)
  }

  const value = {
    t,
    i18n,
    language: i18n.language,
    changeLanguage,
  }

  return <AppContext.Provider value={value}>{children}</AppContext.Provider>
}

export function useApp() {
  const context = useContext(AppContext)
  if (!context) {
    throw new Error('useApp must be used within AppProvider')
  }
  return context
}
```

## 与项目规范集成

### 单人项目（中质量）

- ✅ 必须：基本的多语言支持（zh-CN, en-US）
- ✅ 必须：使用命名空间组织语料
- 💡 建议：关键页面和组件提供翻译
- 🆓 可选：完整的多语言覆盖

### 小组项目（高质量）

- ✅ 必须：完整的多语言支持
- ✅ 必须：所有用户可见文本都要翻译
- ✅ 必须：语料文件结构一致
- ✅ 必须：新增功能同步更新所有语言
- 💡 建议：使用自动化工具检查翻译完整性

## 工具推荐

### VS Code 插件

- **i18n Ally** - 提供语料文件的智能提示和管理

### 翻译管理

- 使用在线翻译管理平台（如 Lokalise、Crowdin）
- 或使用 Google Sheets 管理翻译
- 定期同步翻译到项目中

## 性能优化

### 按需加载语言包（可选）

对于大型项目，可以按需加载语言包：

```javascript
// src/locales/index.js
import i18n from 'i18next'
import { initReactI18next } from 'react-i18next'
import Backend from 'i18next-http-backend'

i18n
  .use(Backend) // 使用后端加载器
  .use(initReactI18next)
  .init({
    lng: 'zh-CN',
    fallbackLng: 'zh-CN',
    backend: {
      loadPath: '/locales/{{lng}}/{{ns}}.json', // 按需加载路径
    },
  })
```

## 总结

i18n 国际化规范要点：

- ✅ 使用 react-i18next 作为 i18n 库
- ✅ 语料文件按命名空间组织（common、pages、components、messages）
- ✅ 语言代码使用标准格式（zh-CN、en-US）
- ✅ 保持所有语言的语料结构一致
- ✅ 使用有意义的变量名
- ✅ 组件中通过 useTranslation hook 使用翻译
- ✅ 提供语言切换功能
- ❌ 避免在语料中嵌入 HTML
- ❌ 避免使用无意义的 key 名称

选择是否使用 i18n：
- **需要多语言支持** → 使用本规范
- **仅单一语言** → 不需要 i18n
